---
title: "Analyzing the Relationship Between MPG and Transmission"
author: "Matiki"
date: "August 29, 2018"
output: 
  html_document: 
    keep_md: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
# Load all necessary R packages into current session
library(ggplot2)
library(dplyr)
library(GGally)
library(car)
```

## Executive Summary
We are going to investigate MPG for various vehicles using the mtcars dataset. 
We would like to know how the variables affect MPG, and in particular, we want 
to investigate the relationship between MPG and transmission. We are tasked with
answering the following questions:

1) Is manual or automatic transmission better for MPG?
2) Can we quantify the MPG difference between automatic and manual transmission?

To answer these questions we will use both simple linear regression and also a 
multivariate linear regression to model the relationship. Since there are 
several variables we could include in many different linear models we could fit,
we will use a backwards elimination method to attempt to find the best fitting 
linear regression model for our given data.

## Exploratory analysis
We'll start by taking a look at the data and doing some exploratory analysis. 
We first will load the mtcars data and take a look at the first few rows. 
Then we'll peek at the structure and get a quick summary of the data. For more 
information about the data we can look at the help file.

```{r}
# Read data into R
data("mtcars")

# Take a look at the data
head(mtcars)
str(mtcars)
summary(mtcars)
#?mtcars
```

It seems **am** and **vs** are binary factor variables, and **cyl**, **gear**, & **carb** are multi-
level factor variables, since they can only take integer values they are not 
continuous. However for simplicity we will treat them as continuous variables 
in our model. We'll convert the desired variables into factor variables.

```{r}
# Convert to factor variables
mtcars$vs <- as.factor(mtcars$vs)
mtcars$am <- as.factor(mtcars$am)

# Check that the changers took hold
str(mtcars)
```

We'll explore the data a bit further to help inform our modeling process. First 
let's see how the variables in **mtcars** are correlated to each other.

```{r}
# Get correlation matrix of the continuous variables
mtcars[, c(1, 3:7)] %>% 
        ggcorr(label = T)
```

It seems many of the variables show strong correlation to the other variables, 
so it is likely not all of them will be used in the final model, otherwise we 
might have overfitting.

Let's check to see how the **mpg** data are distributed. We'll plot the density 
along with a red line for the mean and blue lines representing the 95% confidence
intervals.

```{r}
# Check to see if mpg is normally distributed
ggplot(mtcars, aes(mpg)) +
        geom_density() +
        xlim(0, 50) + 
        geom_vline(xintercept = mean(mtcars$mpg),
                   color = "red",
                   linetype = "dashed") +
        geom_vline(xintercept = mean(mtcars$mpg) - 2 * sd(mtcars$mpg),
                   color = "blue",
                   linetype = "dashed") +
        geom_vline(xintercept = mean(mtcars$mpg) + 2 * sd(mtcars$mpg),
                   color = "blue",
                   linetype = "dashed") 
```

Looks like the data may not be normally distributed. It appears slightly skewed
and it might be tail heavy. This could throw off our model a bit, but for now 
we'll continue.

## Inference & Hypothesis Testing

Now we'll plot **mpg** vs **am** to visualize how the two are related, and then
look the mean mpg for cars with manual and automatic transmissions.

```{r}
# Plot mpg vs am
ggplot(mtcars,
       aes(x = am,
           y = mpg)) +
        geom_point()

# Look at the mean mpg for cars with/without automatic 
mtcars %>% group_by(am) %>%
        summarize(mean = mean(mpg))
```

So it looks like there's a difference in average mpg for automatic and manual 
transmission cars. Cars with automatic transmission have an average mpg of 17.1
and those with manual transmission have an average mpg of 24.4

However the two groups do not appear to have the same variance, so let's keep 
this in mind while running a hypothesis test to see if this difference may be
statistically significant. We'll perform a two group T-test and we will choose 
our alpha to be 0.05.

```{r}
# Welch Two Sample T test
t.test(mpg ~ am, data= mtcars, 
       var.equal = FALSE, paired=FALSE, conf.level = .95)
```

So it seems manual transmission is associated with an increase in mpg of 7.25, 
and this is significant with a p-value of 0.001374.

## Model Selection


## Diagnostics


## Conclusion
